<% content_for :title, @event.title %>

<%= render layout: "shared/centered_container_wrapper" do %>
  <h1 class="font-bold text-4xl"><%= @event.title %></h1>

  <div id="<%= dom_id @event %>" class="my-5 w-full sm:w-auto">
    <div class="flex flex-wrap md:flex-nowrap gap-4 w-full">
      <div class="space-y-5 grow basis-1/2">
        <div class="flex gap-2">
          <div class="font-bold"><i class="fa-solid fa-user-tie"></i> Organized by:</div>
          <div class=""><%= @event.organizers.map { |organizer| organizer.username }.join(", ") %></div>
        </div>

        <div class="flex lg:sm:flex-row flex-col md:flex-col gap-2 -mt-4 w-full">
          <div class="bg-gray-50 p-2 py-1.5 border border-gray-300 rounded-md grow basis-1/2">
            <strong class="block mb-1"><i class="fa-regular fa-calendar"></i> Date:</strong>
            <%= @event.formatted_date %>
          </div>

          <div class="bg-gray-50 p-2 py-1.5 border border-gray-300 rounded-md grow basis-1/2">
            <strong class="block mb-1"><i class="fa-regular fa-calendar"></i> Ending date:</strong>
            <%= @event.formatted_ending_date %>
          </div>
        </div>

        <div class="flex lg:sm:flex-row flex-col md:flex-col gap-2 -mt-3 w-full">
          <div class="bg-gray-50 p-2 py-1.5 border border-gray-300 rounded-md grow basis-1/2">
            <strong class="block mb-1"><i class="fa-regular fa-hourglass-half"></i> Starts for:</strong>
            <%= @event.starting_for %>
          </div>

          <div class="bg-gray-50 p-2 py-1.5 border border-gray-300 rounded-md grow basis-1/2">
            <strong class="block mb-1"><i class="fa-regular fa-clock"></i> Duration:</strong>
            <%= @event.duration %>
          </div>
        </div>

        <div>
          <strong class="block mb-1">Description:</strong>
          <div class="bg-gray-50 p-4 py-3 border border-gray-300 rounded-md min-h-64 overflow-auto resize-y">
            <% if @event.description.present? %>
              <%= @event.description %>
            <% else %>
              <em>No description</em>
            <% end %>
          </div>
        </div>

        <div class="flex gap-2 -mt-3">
          <strong class="block"><i class="mr-1 fa-solid fa-users"></i> Attendees:</strong>
          <div class="">
            <%= @event.attendees.count %>
            <% if @event.attendees.include?(current_user) %>
              (including you)
            <% end %>
          </div>
        </div>
      </div>

      <div class="flex flex-col grow basis-1/2">
        <strong class="block mb-1">Location:</strong>
        <%= 
        render partial: "shared/map_location", 
        locals: {
          map_id: "map-#{@event.id}", 
          latitude: @event.latitude, 
          longitude: @event.longitude,
          location_name: @event.location_name,
          has_location_errors: false,
          has_location_name_errors: false,
          editable: false
        }
      %>
      </div>
    </div>
  </div>

  <% if joined_event?(@event) %>
    <%= link_to "Leave event", leave_event_path, data: { turbo_method: :delete }, class: "inline-block bg-red-600 hover:bg-red-500 mt-2 sm:mt-0 mr-1 px-4 py-2 border-[0.5px] border-neutral-500 rounded-md w-full sm:w-auto text-white text-center" %>
  <% else %>
    <%= link_to "Join event", join_event_path, data: { turbo_method: :post}, class: "inline-block bg-green-600 hover:bg-green-500 mt-2 sm:mt-0 mr-1 px-4 py-2 border-[0.5px] border-neutral-500 rounded-md w-full sm:w-auto text-white text-center" %>
  <% end %>

  <%= link_to "Back to events", events_path, class: "inline-block bg-gray-100 hover:bg-gray-50 mt-2 sm:mt-0 mr-1 px-4 py-2 border-[0.5px] border-neutral-500 rounded-md w-full sm:w-auto text-center" %>

  <% if @event.organizers.include?(current_user) %>
    <%= link_to "Edit this event", edit_event_path(@event), class: "inline-block bg-blue-600 hover:bg-blue-500 mt-2 sm:mt-0 px-4 py-2 border-[0.5px] border-neutral-500 rounded-md w-full sm:w-auto text-white text-center" %>
    <%= button_to "Destroy this event", @event, method: :delete, form_class: "sm:inline-block mt-2 sm:mt-0 sm:ml-1", class: "bg-red-600 hover:bg-red-500 px-4 py-2 border-[0.5px] border-neutral-500 rounded-md w-full text-white cursor-pointer", data: { turbo_confirm: "Are you sure?" } %>
  <% end %>
<% end %>
